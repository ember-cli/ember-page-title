{"version":3,"file":"page-title.js","sources":["../../src/services/page-title.ts"],"sourcesContent":["import { scheduleOnce } from '@ember/runloop';\nimport Service, { inject as service } from '@ember/service';\nimport { isEmpty } from '@ember/utils';\nimport { assert } from '@ember/debug';\nimport type ApplicationInstance from '@ember/application/instance';\nimport type RouterService from '@ember/routing/router-service';\nimport type Owner from '@ember/owner';\n\nimport type {\n  FastBootDocument,\n  PageTitleToken,\n  PageTitleConfig,\n} from '../private-types.ts';\n\nconst isFastBoot = typeof FastBoot !== 'undefined';\n\nconst RouterEvent = {\n  ROUTE_DID_CHANGE: 'routeDidChange',\n} as const;\n\nfunction hasResolveRegistration(owner: Owner): owner is ApplicationInstance {\n  return `resolveRegistration` in owner;\n}\n\nfunction hasPageTitleConfig(\n  fromEnv: unknown,\n): fromEnv is { pageTitle: PageTitleConfig } {\n  if (typeof fromEnv !== 'object') return false;\n  if (fromEnv === null) return false;\n\n  // all properties on the pageTitle config are optional,\n  // so we can't check for more\n  return 'pageTitle' in fromEnv;\n}\n\nconst configKeys = ['separator', 'prepend', 'replace'] as const;\n\n/**\n  @class page-title\n  @extends Ember.Service\n */\nexport default class PageTitleService extends Service {\n  @service('router') declare router: RouterService;\n\n  // in fastboot context \"document\" is instance of\n  // ember-fastboot/simple-dom document\n  @service('-document') private declare document: FastBootDocument;\n\n  tokens: PageTitleToken[] = [];\n\n  _defaultConfig: PageTitleConfig = {\n    // The default separator to use between tokens.\n    separator: ' | ',\n\n    // The default prepend value to use.\n    prepend: true,\n\n    // The default replace value to use.\n    replace: null,\n  };\n\n  constructor(owner: Owner) {\n    super(owner);\n    this._validateExistingTitleElement();\n\n    if (hasResolveRegistration(owner)) {\n      const config = owner.resolveRegistration('config:environment');\n\n      if (hasPageTitleConfig(config)) {\n        configKeys.forEach((key) => {\n          if (!isEmpty(config.pageTitle[key])) {\n            const configValue = config.pageTitle[key];\n\n            // SAFETY: how is one supposed to iterate over keys for an object and have it\n            //         known to the compiler that both objects, having the same shape,\n            //         will have the same type per-value?\n            //         as-is, the `configValue` is a union of all value-types from the object.\n            (this._defaultConfig[key] as PageTitleConfig[typeof key]) =\n              configValue;\n          }\n        });\n      }\n    }\n    this.router.on(RouterEvent.ROUTE_DID_CHANGE, this.scheduleTitleUpdate);\n  }\n\n  applyTokenDefaults(token: PageTitleToken) {\n    const defaultSeparator = this._defaultConfig.separator;\n    const defaultPrepend = this._defaultConfig.prepend;\n    const defaultReplace = this._defaultConfig.replace;\n\n    token.previous ??= null;\n    token.next ??= null;\n\n    if (token.separator == null) {\n      token.separator = defaultSeparator;\n    }\n\n    if (token.prepend == null && defaultPrepend != null) {\n      token.prepend = defaultPrepend;\n    }\n\n    if (token.replace == null && defaultReplace != null) {\n      token.replace = defaultReplace;\n    }\n  }\n\n  inheritFromPrevious(token: PageTitleToken) {\n    const previous = token.previous;\n    if (previous) {\n      if (token.separator == null) {\n        token.separator = previous.separator;\n      }\n\n      if (token.prepend == null) {\n        token.prepend = previous.prepend;\n      }\n    }\n  }\n\n  push(token: PageTitleToken) {\n    const tokenForId = this._findTokenById(token.id);\n    if (tokenForId) {\n      const index = this.tokens.indexOf(tokenForId);\n      const tokens = [...this.tokens];\n      const previous = tokenForId.previous;\n      token.previous = previous;\n      token.next = tokenForId.next;\n      this.inheritFromPrevious(token);\n      this.applyTokenDefaults(token);\n\n      tokens.splice(index, 1, token);\n      this.tokens = tokens;\n      return;\n    }\n\n    const previous = this.tokens.slice(-1)[0];\n    if (previous) {\n      token.previous = previous ?? null;\n      previous.next = token;\n      this.inheritFromPrevious(token);\n    }\n\n    this.applyTokenDefaults(token);\n    this.tokens = [...this.tokens, token];\n  }\n\n  remove(id: PageTitleToken['id']) {\n    const token = this._findTokenById(id);\n\n    if (!token) return;\n\n    const { next, previous } = token;\n    if (next) {\n      next.previous = previous;\n    }\n\n    if (previous) {\n      previous.next = next;\n    }\n\n    token.previous = token.next = null;\n\n    const tokens = [...this.tokens];\n    tokens.splice(tokens.indexOf(token), 1);\n    this.tokens = tokens;\n  }\n\n  get visibleTokens(): PageTitleToken[] {\n    const tokens = this.tokens;\n    let i = tokens ? tokens.length : 0;\n    const visible = [];\n    while (i--) {\n      const token = tokens[i];\n\n      if (!token) continue;\n\n      if (token.replace) {\n        visible.unshift(token);\n        break;\n      } else {\n        visible.unshift(token);\n      }\n    }\n    return visible;\n  }\n\n  get sortedTokens(): PageTitleToken[] {\n    const visible = this.visibleTokens;\n    if (!visible) return [];\n\n    let appending = true;\n    let group: PageTitleToken[] = [];\n    const groups = [group];\n    const frontGroups: PageTitleToken[] = [];\n\n    visible.forEach((token) => {\n      if (token.front) {\n        frontGroups.unshift(token);\n      } else if (token.prepend) {\n        if (appending) {\n          appending = false;\n          group = [];\n          groups.push(group);\n        }\n        const lastToken = group[0];\n        if (lastToken) {\n          token = { ...token };\n          token.separator = lastToken.separator;\n        }\n        group.unshift(token);\n      } else {\n        if (!appending) {\n          appending = true;\n          group = [];\n          groups.push(group);\n        }\n        group.push(token);\n      }\n    });\n\n    return frontGroups.concat(groups.reduce((E, group) => E.concat(group), []));\n  }\n\n  scheduleTitleUpdate = () => {\n    scheduleOnce('afterRender', this, this._updateTitle);\n  };\n\n  toString(): string {\n    const tokens = this.sortedTokens;\n    const title = [];\n\n    for (let i = 0, len = tokens.length; i < len; i++) {\n      const token = tokens[i];\n      if (!token) continue;\n\n      if (token.title) {\n        title.push(token.title);\n        if (i + 1 < len) {\n          title.push(token.separator);\n        }\n      }\n    }\n\n    return title.join('');\n  }\n\n  willDestroy() {\n    super.willDestroy();\n    this.router.off(RouterEvent.ROUTE_DID_CHANGE, this.scheduleTitleUpdate);\n  }\n\n  private _updateTitle() {\n    const toBeTitle = this.toString();\n\n    if (isFastBoot) {\n      this.updateFastbootTitle(toBeTitle);\n    } else {\n      /**\n       * When rendering app with \"?fastboot=false\" (http://ember-fastboot.com/docs/user-guide#disabling-fastboot)\n       * We will not have <title> element present in DOM.\n       *\n       * But this is fine as by HTML spec,\n       * one is created upon assigning \"document.title\" value;\n       *\n       * https://html.spec.whatwg.org/multipage/dom.html#dom-tree-accessors\n       */\n      this.document.title = toBeTitle;\n    }\n\n    this.titleDidUpdate(toBeTitle);\n  }\n\n  /**\n   * Validate if there's more than one title element present.\n   *\n   * Example: ember-cli-head can cause conflicting updates.\n   * @private\n   */\n  private _validateExistingTitleElement() {\n    if (isFastBoot) {\n      return;\n    }\n    assert(\n      '[ember-page-title]: Multiple title elements found. Check for other addons like ember-cli-head updating <title> as well.',\n      document.head.querySelectorAll('title').length <= 1,\n    );\n  }\n\n  /**\n   * Find token by id\n   *\n   * @param {String} id\n   * @private\n   */\n  private _findTokenById(id: PageTitleToken['id']) {\n    return this.tokens.find((token) => token.id === id);\n  }\n\n  updateFastbootTitle(toBeTitle: string) {\n    if (!isFastBoot) {\n      return;\n    }\n    const headElement = this.document.head;\n    const headChildNodes = headElement.childNodes;\n\n    // Remove existing title elements from previous render cycle\n    for (let i = 0; i < headChildNodes.length; i++) {\n      const node = headChildNodes[i];\n      if (!node) continue;\n\n      if (node.nodeName.toLowerCase() === 'title') {\n        headElement.removeChild(node);\n      }\n    }\n\n    // Add title element with latest value\n    const titleEl = this.document.createElement('title');\n    const titleContents = this.document.createTextNode(toBeTitle);\n    titleEl.appendChild(titleContents);\n    headElement.appendChild(titleEl);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  titleDidUpdate(_title: string) {\n    // default is empty, meant to be overriden by user if desired\n  }\n}\n"],"names":["isFastBoot","FastBoot","RouterEvent","ROUTE_DID_CHANGE","hasResolveRegistration","owner","hasPageTitleConfig","fromEnv","configKeys","PageTitleService","_dec","service","_dec2","_class","Service","constructor","_initializerDefineProperty","_descriptor","_descriptor2","_defineProperty","separator","prepend","replace","scheduleOnce","_updateTitle","_validateExistingTitleElement","config","resolveRegistration","forEach","key","isEmpty","pageTitle","configValue","_defaultConfig","router","on","scheduleTitleUpdate","applyTokenDefaults","token","defaultSeparator","defaultPrepend","defaultReplace","previous","next","inheritFromPrevious","push","tokenForId","_findTokenById","id","index","tokens","indexOf","splice","slice","remove","visibleTokens","i","length","visible","unshift","sortedTokens","appending","group","groups","frontGroups","front","lastToken","concat","reduce","E","toString","title","len","join","willDestroy","off","toBeTitle","updateFastbootTitle","document","titleDidUpdate","assert","head","querySelectorAll","find","headElement","headChildNodes","childNodes","node","nodeName","toLowerCase","removeChild","titleEl","createElement","titleContents","createTextNode","appendChild","_title","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer"],"mappings":"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"}